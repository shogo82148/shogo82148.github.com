---
layout: post
title: "Webブラウザを使って電波を出してみた"
date: 2016-03-29 12:19
comments: true
categories: [javascript]
---

読者の持っている至って普通のコンピューターは、実は電波時計の時刻合わせを行うために必要な標準電波の発信装置が備わっている。

コードは以下から入手できる。

- [shogo82148/web-jjy](https://github.com/shogo82148/web-jjy)
- [JJYシミュレータWeb版](http://shogo82148.github.io/web-jjy/)

<!-- More -->

## 動かし方

パソコンのイヤホンジャックにアンテナ(普通のイヤホンで十分です)を接続し、電波時計の近くに置きます。
音量を最大にし、「Start」ボタンを押すと信号が送信されます。
電波時計を強制受信モードにし、時刻が設定されるのを待ちましょう。

パソコンの時間を基準にするので、あらかじめntpとかで時刻設定をしておくといいと思います。


## 原理

[標準電波JJY](http://jjy.nict.go.jp/jjy/trans/index.html)は日本標準時のタイムコードを送信する電波で、
東日本では40kHz、西日本では60kHzの周波数で発信されています。
電波時計はこの信号を使って時刻合わせをしています。

この信号をオーディオデバイスから出力する[電波時計用JJYシミュレータ](http://www.starstonesoft.com/jjy_simulator.htm)というものがあるのを知り、
「今のWebブラウザならjavascriptだけで実装できるのでは？」と思いやってみました。
一般的なオーディオデバイスは、20kHz以上の周波数の再生には適していないため、そのままでは40kHz/60kHzの信号は出せません。
そこで、[電波時計用JJYシミュレータ](http://www.starstonesoft.com/jjy_simulator.htm)は、歪んだ波形に含まれる高調波を利用しています。
ボリュームを大きくして音が割れた状態になると、音声信号は矩形波に近いかたちになります。
矩形波には3倍、5倍、7倍...の奇数倍の周波数成分が含まれているため、
([世はまさに大フーリエ時代](http://togetter.com/li/942071)とか見ると楽しい)
13.333kHzの矩形波を出力することで、39.999kHzの信号を出せるというわけです。

元のソフトウェアはWindowsのバイナリ形式でしたが、
WebAudioの登場によりWebブラウザからも同様のことが行えるようになりました。


## 最後に

少し前にCPUから出るノイズを使ってAMラジオの電波を発信するという記事が話題になりましたね。

- [普通のコンピューターからAMラジオを鳴らそう](http://cpplover.blogspot.jp/2016/03/am.html)

CPUやオーディオデバイスも電気で動いている以上、電波が出ているのは当たり前のことなのですが、
こうやって改めて確認できると面白いですね。

パソコンから出る程度の電波強度では、電波法に抵触することはないと思いますが、
うっかり強力な電波を発信しないよう気をつけてください。
