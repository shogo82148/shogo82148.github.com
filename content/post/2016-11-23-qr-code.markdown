---
layout: post
title: "Twitterの二次元コード問題と、QRコード・フレームQRの見分け方"
slug: qr-code
date: 2016-11-23 10:32:43 +0900
comments: true
categories: [qrcode]
---

先日Twitterの公式アプリがQRコード®
([お店やお友達を簡単にフォローするために](https://blog.twitter.com/ja/2016/1117qrcode))
の作成と読み取りに対応しました。
しかし、生成されるQRコードが標準規格に準拠していないため、
「他のリーダーで読めない」「法的に問題があるのでは？」等々の指摘が出ていました。
人事ながらTwitterさんのことが心配になったので少し調べてみました。

なお、僕は法律の専門家ではないため、本記事の正確性は保証できません。
あくまで個人的な見解なので、
実際にQRコード®を使用するさいは各自の判断でお願いします。

<!-- More -->

## 指摘ツイート

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">Twitterが生成するQRコード、規格(JIS X 0510・ISO/IEC 18004)を大幅に逸脱しているので「QRコード®」を名乗ること自体に法的なリスクがある。</p>&mdash; 祥太(4/15レイフレ18 C19+20) (@shota_) <a href="https://twitter.com/shota_/status/799066842694197248?ref_src=twsrc%5Etfw">2016年11月17日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-conversation="none" data-lang="ja"><p lang="ja" dir="ltr">「デンソーウェーブは、JIS、ISOの規格に沿ったQRコードに限っては特許権を行使しませんが、規格を逸脱したQRコードについてはこの限りではございませんので、特許権を行使させていただくこともございます。」<br><br>(出典: <a href="https://t.co/SKXgBGSb8E">https://t.co/SKXgBGSb8E</a> )</p>&mdash; 祥太(4/15レイフレ18 C19+20) (@shota_) <a href="https://twitter.com/shota_/status/799066960466034689?ref_src=twsrc%5Etfw">2016年11月17日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-conversation="none" data-lang="ja"><p lang="ja" dir="ltr">明暗暗転で読み取らないという話を多数見かけますけど、そちらについては「ISO/IEC 18004からは逸脱」「JIS X 0510には準拠」(規格票7.3.8参照)という微妙な状況なのです。多分ISOには準拠しているのでアプリは悪くないと思います。</p>&mdash; 祥太(4/15レイフレ18 C19+20) (@shota_) <a href="https://twitter.com/shota_/status/799104490095808512?ref_src=twsrc%5Etfw">2016年11月17日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


たしかに [qrcode.comのFAQ](http://www.qrcode.com/faq.html)には
特許について以下の記述があります。

> 色を付けたりイラストを入れるような使い方をしても問題ありませんか？
> (中略)
> また、QRコードにイラストを重ねたりデザインを乗せるということは、QRコードの規格から外れ「QRコードではないもの」となってしまう可能性がございます。
> デンソーウェーブは、JIS、ISOの規格に沿ったQRコードに限っては特許権を行使しませんが、規格を逸脱したQRコードについてはこの限りではございませんので、特許権を行使させていただくこともございます。

## 問題点

公式アプリの生成する二次元コードは以下のような問題があります。

- データパターンの20%近くがアイコンで上書きされている
- 「アライメントパターン」がTwitterのロゴで欠けている
- 明暗暗転している(一応JISには沿っているらしい)

法的リスク以前に、
読み取り性能/互換性が劣化するので使わない方が無難でしょう。

自分のプロフィールのURL
(僕の場合は [https://twitter.com/shogo82148](https://twitter.com/shogo82148) )を
QRコードに変換すれば公式アプリのリーダーでも読めるので、
こちらの方がオススメです。

![僕のQRコード](http://chart.apis.google.com/chart?cht=qr&chs=130x130&chl=https://twitter.com/shogo82148)


## QRコード関連の権利

### 特許

QRコード®のJIS規格JIS X 0510には、
関連する特許として特許第2938338号「二次元コード」があげられています。
ただし、特許の保護期間は20年なので、1994年に出願されたこの特許は2014年で消滅しています。
したがってこの特許を理由に訴えられることはなさそうです。

ところがQRコードには実はモデル1とモデル2の二種類があり、
モデル2に関しては特許第3716527号「２次元コードおよび２次元コードの読取方法」が
該当しそうです。
この特許は「アライメントパターン」という特殊なパターンを二次元コードに埋め込んで、
大きなコードや曲面に印刷されたコードも読み取れるようにするというものです。
こちらは2017年1月28日までが保護期間で、この記事を書いている時点ではまだ保護期間内です。

Twitter公式アプリの二次元コードはモデル2にが該当するので、
この特許を理由に訴えられる可能性は依然としてありそうです。
ただし、期限が切れる2017年1月29日以降であれば、堂々と規格違反のQRコードを作れるはず(?)
(繰り返しになりますが、僕が関連特許を見落としている可能性もあるので、実際の使用は各自の判断で)


### 商標

商標にも保護期限ってあるのかなあと調べてみたところ、
10年の期限はあるものの上限なく延長できるそうです。
したがって、QRコード®でないものをQRコード®として公開するのはまずそうです。

なお、作った二次元コード自体は商標ではないので、
公式アプリで作ったコードを利用するだけであれば何も問題はないはずです。
ユーザが訴えられる可能性はほとんどないのでご安心を。


## フレームQRについて

QRコード®も進化していて、今はフレームQR®というものがあり、
コードの中に画像を埋め込めるそうです。

- https://twitter.com/awKaoru/status/799074365572644865

ググって調べてみたところ、これには特許第5057560号「プログラム、情報記憶媒体、２次元コード、印刷物、２次元コード画像、２次元コード画像の表示制御方法、２次元コード生成システム」
が関連していそうです。
この特許、出願人がQRコード®の開発元であるデンソーウェーブではなく、
株式会社バンダイナムコエンターテインメントなんですよね。
QRコード®が比較的オープンなのに対してフレームQR®関連の資料がないのは
この辺が関連しているのでしょうか・・・。

### QRコードとフレームQR見分け方

さて気になるのは、Twitterの二次元コードがフレームQR®に該当するか、ですよね。

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">QRフレームと違うらいいけどそもそもQRフレームの定義がわからないせいで違いがわからない・・・  自由に使えるキャンパス領域に描いてるように見えるような気もするんだけど</p>&mdash; 桜花 (@rofi) <a href="https://twitter.com/rofi/status/799088728035598336?ref_src=twsrc%5Etfw">2016年11月17日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


結論から言うと、**QRコード®とフレームQR®は別物** であり、
 **Twitterの二次元コードはフレームQR®ではありません**。

具体的な見分け方ですが、QRコード®に特徴的な「位置検出パターン」「タイミングパターン」「アライメントパターン」は
フレームQR®にもあるため、「型式情報」を頑張って読み取るしかないようです。
「型式情報」は[BCH符号](https://ja.wikipedia.org/wiki/BCH%E7%AC%A6%E5%8F%B7)で符号化されているため、
人間が手動で復号するのは少し大変です。
「型式情報」はたったの32パターンしかないので、
**すべてのパターンを覚えるのが一番楽** な方法です。
というわけで、パターン一覧を作ってみました。

- [パターン一覧](/images/2016-11-23-qrlist.svg)
- [生成プログラム](https://gist.github.com/shogo82148/07018ddad8f001e149a5aa34b0dff2c4)

QRコード®やフレームQR®には「位置検出パターン」と呼ばれる「回」のようなパターンが3つあります。
このうち左上のパターンの周りに「型式情報」があります
(本当は冗長性のために他の2つの位置検出パターンの周りにもあるけど、左上のが一番みやすい)。
先ほどの[パターン一覧](/images/2016-11-23-qrlist.svg)から一番近いものを探しましょう。
各行の一番左を手掛かりにすると探しやすいです。
その隣に「QRコード®モデル1」「QRコード®モデル2」「フレームQR®」に並んでいます。
以下は僕のコードを調べてみたときの例です。

![解析例](/images/2016-11-23-sample.svg)

**さあ、これで君もQRコードーリーダーになれる！！**


## まとめ

- Twitterの二次元コードはQRコード®でもフレームQR®でもない
- やっぱり法的リスクはありそう(な気がする)
  - 少なくとも2017年1月28日までは特許権を理由に訴えられる可能性あり
  - QRコード®の商標を使っているのは危なそう
- ユーザに対しての法的リスクはないので、公式アプリの二次元コードの利用はご自由に
  - でも、法的に問題なくても、規格違反なので使わない方が無難


## 参考

- JIS X 0510 二次元コードシンボル―ＱＲコード―基本仕様
- 特許第2938338号「二次元コード」
- 特許第3716527号「２次元コードおよび２次元コードの読取方法」
- 特許第5057560号「プログラム、情報記憶媒体、２次元コード、印刷物、２次元コード画像、２次元コード画像の表示制御方法、２次元コード生成システム」

QRコード®およびフレームQR®は[(株)デンソーウェーブ](http://www.denso-wave.com/)の登録商標です
