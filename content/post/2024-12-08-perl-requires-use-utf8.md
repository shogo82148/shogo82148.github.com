---
layout: post
title: "Perl 5.41ã‹ã‚‰ã€UTF-8ã§æ›¸ã‹ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¯use utf8ãŒå¿…é ˆã«ãªã‚Šã¾ã™"
slug: perl-requires-use-utf8
date: 2024-12-08 22:37:00 +0900
comments: true
categories: [perl]
---

ã“ã®è¨˜äº‹ã¯ã€[Perl Advent Calendar 2024](https://qiita.com/advent-calendar/2024/perl) 8æ—¥ç›®ã®è¨˜äº‹ï¼ˆä»£æ‰“ï¼‰ã§ã™ã€‚
7æ—¥ç›®ã¯[@MacOlin](https://qiita.com/MacOlin)ã§ã€Œ[JSON::PPã®decodeãƒ¡ã‚½ãƒƒãƒ‰ã®é€Ÿåº¦æ¯”è¼ƒ](https://qiita.com/MacOlin/items/9fff42686f6dac5b0f2e)ã€ã§ã—ãŸã€‚

-----

Perl 5.41.2ï¼ˆé–‹ç™ºç‰ˆï¼‰ã‹ã‚‰ [source::encodingãƒ—ãƒ©ã‚°ãƒ](https://metacpan.org/release/ETHER/perl-5.41.2/view/lib/source/encoding.pm)ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
ã“ã®ãƒ—ãƒ©ã‚°ãƒã®è¿½åŠ ã«ã‚ˆã‚Šã€UTF-8ã§æ›¸ã‹ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã¯ `use utf8` ãŒå¿…é ˆã«ãªã‚Šã¾ã™ã€‚

## TL;DR

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å…ˆé ­ã« `use utf8` ã£ã¦æ›¸ã„ã¦ãŠã‘ã°OKã€‚

## use utf8ã®å¿…é ˆåŒ–

ãŸã¨ãˆã°ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«ã¯UTF-8ã®æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€ `use utf8` ã®æŒ‡å®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚

```perl
use v5.41;

# ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’Perl 5.41.2ï¼ˆé–‹ç™ºç‰ˆï¼‰ã§å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã‚’åã„ã¦çµ‚äº†ã—ã¾ã™ã€‚

```plain
Use of non-ASCII character 0xE3 illegal when 'use source::encoding "ascii"' is in effect at hoge.pl line 3, at end of line
Execution of hoge.pl aborted due to compilation errors.
```

ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã‚ã£ã¦ã‚‚æ—¥æœ¬èªã¯ä½¿ãˆãªã„ã‚“ã§ã™ã­ã€‚

æ­£ã—ãå®Ÿè¡Œã™ã‚‹ã«ã¯ `use utf8` ã‚’æ˜ç¤ºã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒUTF-8ã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```perl
use v5.41;
use utf8;

# ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ
```

ã“ã‚Œã¯ `use utf8` ã‚’ã†ã£ã‹ã‚Šæ›¸ãå¿˜ã‚Œã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã®å‡¦ç½®ã ãã†ã§ã™ã€‚

- [perldelta - what is new for perl v5.41.2](https://metacpan.org/release/ETHER/perl-5.41.2/view/pod/perldelta.pod)

## source::encodingãƒ—ãƒ©ã‚°ãƒ

`use utf8` å¿…é ˆåŒ–ã®æ©Ÿèƒ½ã®ã¿ã‚’åˆ¶å¾¡ã™ã‚‹ã«ã¯ã€`source::encoding` ãƒ—ãƒ©ã‚°ãƒã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ãŸã¨ãˆã°ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒASCIIã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã™ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚

```perl
use source::encoding 'ascii';

# You can use only ASCII characters.
```

`use source::encoding 'ascii'` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ASCIIã‚³ãƒ¼ãƒ‰ç¯„å›²å¤–ã®æ–‡å­—ã‚’ä½¿ã†ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```perl
use source::encoding 'ascii';

# æ—¥æœ¬èªã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼
```

`use v5.41` feature bundle ã§ `use source::encoding 'ascii'` ã‚‚æœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ãŸã‚ã€
`use v5.41` ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä¸­ã§æ—¥æœ¬èªã‚’æ›¸ãã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

æ—¥æœ¬èªã®ã‚ˆã†ãªASCIIç¯„å›²å¤–ã®æ–‡å­—ã‚’ä½¿ã„ãŸã„å ´åˆã¯ `use source::encoding 'utf8'` ã¨æ›¸ã„ã¦ã€UTF-8ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

```perl
use source::encoding 'utf8'; # use utf8; ã¨åŒã˜

# ASCIIç¯„å›²å¤–ã®æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
```

`use utf8` ã¯ `use source::encoding 'utf8'` ã®ã‚·ãƒãƒ‹ãƒ ãªã®ã§ã€`use utf8` ã¨æ›¸ã„ã¦ã‚‚åŒã˜åŠ¹æœã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚

æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦æŒ‡å®šã§ãã‚‹ã®ã¯ `ascii` ã¨ `utf8` ã®ã¿ã§ã™ã€‚
ä»–ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚

```perl
use source::encoding 'euc-jp'; # Bad argument for source::encoding: 'euc-jp'
```

## ã¾ã¨ã‚

ä»¥å‰ã‹ã‚‰ `use utf8` ã‚’ã¤ã‘ã¦ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒUTF-8ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤ºã§ãã¾ã—ãŸãŒã€`use utf8` ã®è¨­å®šã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã—ã‹ã—ã€Perl 5.41.2ï¼ˆé–‹ç™ºç‰ˆï¼‰ä»¥é™ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒUTF-8ã§ã‚ã‚‹ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš `use utf8` ã®æŒ‡å®šã‚’å¿˜ã‚Œã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
åƒ•ã‚‰ã®ã‚ˆã†ãªæ—¥æœ¬èªè©±è€…ã«ã¨ã£ã¦ã¯é‡è¦ãªå¤‰æ›´ã§ã™ã­ã€‚

ã€Œã“ã“ã¾ã§ã®è©±é›£ã—ã™ãã¦ä½•è¨€ã£ã¦ã„ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€ã¨ã„ã†äººã¯ã€ã€Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å…ˆé ­ã« `use utf8` ã£ã¦æ›¸ã„ã¦ãŠã‘ã°OKã€ã¨ã ã‘è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚
ä»Šã©ãutf-8ä»¥å¤–ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ©Ÿä¼šãªã‚“ã¦ãªã„ã§ã—ã‚‡ã†ã‹ã‚‰ï¼ˆãƒ•ãƒ©ã‚°ï¼‰ã€‚

ãªãŠæ¤œè¨¼ã«ä½¿ç”¨ã—ãŸã®ã¯é–‹ç™ºç‰ˆã®Perlã§ã™ã€‚å®‰å®šç‰ˆã§ã¯æŒ™å‹•ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

> ğŸ‡\
> æ–°ã—ã„ãƒ—ãƒ©ã‚°ãƒã€å¬‰ã—ã•æº€è¼‰ã€\
> PerlãŒé€²åŒ–ã—ã€æœªæ¥ã‚‚é–‹ã‘ã€‚\
> ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å…‰ã€ã•ã‚ç…§ã‚‰ã›ã€\
> ã‚³ãƒ¼ãƒ‰ãŒè¸Šã‚Šã€å¿ƒã‚‚å¼¾ã‚€ã€‚\
> ã‚ˆã†ã“ãã€å¤‰åŒ–ã®æ™‚ã‚ˆï¼\
> ğŸŒŸ
>
> by [CodeRabbit](https://coderabbit.ai/)

-----

æ˜æ—¥9æ—¥ç›®ã¯TBDã§ã€ŒTBDã€ã§ã™ã€‚ ãŠæ¥½ã—ã¿ã«ï¼

## å‚è€ƒ

- [perldelta - what is new for perl v5.41.2](https://metacpan.org/release/ETHER/perl-5.41.2/view/pod/perldelta.pod)
