<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&family=Noto+Sans+Mono&display=swap" rel="stylesheet"> 

  
  <title>OAuthの認証にWebViewを使うのはやめよう</title>

  
  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  
    <link rel="stylesheet" href="https://shogo82148.github.io/css/syntax.css">
  

  
    <link rel="stylesheet" href="/css/fork-awesome.min.css">
  

  
  <link href="https://shogo82148.github.io/favicon.png" rel="icon">

  
  

  <meta name="description" content="" />
  <meta name="keywords" content="">
  <meta name="author" content="ICHINOSE Shogo">

  
  <meta name="generator" content="Hugo 0.91.2" />

  
  
  


<script async src="https://www.googletagmanager.com/gtag/js?id=G-40R0PCLKVF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-40R0PCLKVF');
</script>

  
  
</head>
<body>


<header role="banner">
<hgroup>
  
  <h1><a href="https://shogo82148.github.io/">Shogo&#39;s Blog</a></h1>
  <h2></h2>
</hgroup>
</header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
  </select>
</fieldset>


<ul class="main-navigation">
  
  
</ul>

<ul class="subscription">
  
</ul>


  <form action="https://www.google.com/search" method="get" target="_blank">
    <fieldset role="search">
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
      <input type="hidden" name="q" value="site:https://shogo82148.github.io/" />
    </fieldset>
  </form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
  <p class="meta">Nov 24, 2012
     - 4 minute read 
     - <a href="https://shogo82148.github.io/blog/2012/11/24/no-more-webview/#disqus_thread">Comments</a>

    
    
      - <a class="label" href="https://shogo82148.github.io/categories/android/">Android </a><a class="label" href="https://shogo82148.github.io/categories/twitter/">Twitter </a>
    
  </p>
  <h1 class="entry-title">
     OAuthの認証にWebViewを使うのはやめよう 
  </h1>
</header>


        <div class="entry-content">
          
          
          
          
          <p>AndroidからTwitterへアクセスするためのライブラリとして，<a href="http://twitter4j.org/ja/index.html">Twitter4J</a>が有名です．
これを使ってみようと，「Android Twitter4J」と検索すると
認証にWebViewを使った例がたくさん出てきます．</p>
<p>・・・いや，ちょっとまて．
それはちょっとまずいだろう．</p>
<p>そういうわけでもうちょっと賢い方法を探してみました．</p>
<!-- More -->
<h2 id="何がまずいのさ">何がまずいのさ</h2>
<p>「Android Twitter4J」と検索すると，上位にこんなページが出てきます．</p>
<ul>
<li><a href="http://andante.in/i/android%E3%82%A2%E3%83%97%E3%83%AAtips/twitter4j%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6oauth%E8%AA%8D%E8%A8%BC%E3%82%92%E3%82%A2%E3%83%97%E3%83%AA%E5%86%85%E3%81%A7%E8%A1%8C%E3%81%86%E6%96%B9%E6%B3%95/">Twitter4jを使ってOAuth認証をアプリ内で行う方法</a></li>
<li><a href="http://blog.kyosuke25.com/2011/12/twitter4j-22xoauth.html">Twitter4j-2.2.xを使ったOAuth認証のコーディング例</a></li>
<li><a href="http://init0.net/wp/archives/171">twitter4jでツイートする</a></li>
<li><a href="http://wada811.blog.fc2.com/blog-entry-103.html">Android+Twitter4JでOAuthするためのソースコード</a></li>
</ul>
<p>上のサイトでは次の様は方法をとっています．</p>
<ul>
<li>アプリ内にWebViewを貼り付け</li>
<li>WebViewでTwitterの認証画面を表示</li>
<li>onPageStarted や onPageFinished をオーバーライドして callback URL へのアクセスを検出</li>
<li>URL に入っている認証コードで認証</li>
</ul>
<p>アプリ内でWebViewを使うとURLが表示されません．
つまり ** 本当にツイッターにアクセスしているかわからない ** のです．
もし，表示されるのが偽の認証画面だったら，アプリから簡単にパスワードがわかってしまいます．</p>
<p>じゃあ，URL を表示させればいいかというとそういうわけでもありません．
画面上のURL表示なんて簡単に偽装できてしまいます．
どんな工夫をしても ** アプリがパスワードの要求をしていることには変わりありません ** ．
アプリはパスワードを簡単に取得できます．</p>
<p>アプリのユーザはTwitterに限らずSNSへのログイン時にブラウザを開かないアプリは信用しないようにしましょう．
どこかでパスワードの抜かれている可能性があります．
(ただし，公式アプリは除く．公式アプリが信用できないならそもそもサービスを利用できないもんね．)</p>
<h2 id="じゃあどうするのさ">じゃあどうするのさ</h2>
<p>じゃあ，開発者はどうするのかって話ですが，もう少し詳しく検索してみましょう．
他の方法を使っているページもでてきます．</p>
<ul>
<li>PINコードを利用
<ul>
<li><a href="http://techbooster.org/android/mashup/14064/">TwitterでPIN番号認証を行う</a></li>
</ul>
</li>
<li>Intent Fileterを利用しコールバック
<ul>
<li><a href="http://d.hatena.ne.jp/yujimny/20110204/1296805905">twitter4jを使用したAndroid Twitterアプリケーション作成</a></li>
<li><a href="http://d.hatena.ne.jp/itog/20120214/1329193954">Twitter4Jを使ってAndroidアプリでStreamingAPIのUserTimelineを取得する</a></li>
<li>TwitterでOAuth認証を行う
<ol>
<li><a href="http://techbooster.org/android/mashup/4525/">Twitterへのアプリケーション登録</a></li>
<li><a href="http://techbooster.org/android/5040/">Twitterの認証ページをブラウザで開く</a></li>
<li><a href="http://techbooster.org/android/mashup/5301/">Access Tokenを取得する</a></li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="pin-コードを利用">PIN コードを利用</h3>
<p>一つ目の方法はPC版クライアントでよく使われる方法．
認証後にPINコードと呼ばれる数字が表示されるので，それをアプリに入力します．
twiccaなんかでも使われてますね．
Twitter へのアプリケーション登録のときにコールバックURLを入力しないとこの認証方式になります．</p>
<p>認証画面に，ブラウザを開くボタン，PINコードの入力ボックス，ログインボタンを用意しておきます．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
    <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span>
    <span class="na">android:orientation=</span><span class="s">&#34;vertical&#34;</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;Button</span>
        <span class="na">android:id=</span><span class="s">&#34;@+id/button_start_login&#34;</span>
        <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
        <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
        <span class="na">android:text=</span><span class="s">&#34;Twitterへアクセス&#34;</span> <span class="nt">/&gt;</span>

   <span class="nt">&lt;EditText</span>
      <span class="na">android:id=</span><span class="s">&#34;@+id/edit_pin_code&#34;</span>
      <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
      <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
      <span class="na">android:ems=</span><span class="s">&#34;10&#34;</span>
      <span class="na">android:inputType=</span><span class="s">&#34;number&#34;</span> <span class="nt">/&gt;</span>

   <span class="nt">&lt;Button</span>
      <span class="na">android:id=</span><span class="s">&#34;@+id/button_login&#34;</span>
      <span class="na">android:layout_width=</span><span class="s">&#34;wrap_content&#34;</span>
      <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span>
      <span class="na">android:layout_below=</span><span class="s">&#34;@+id/edit_pin_code&#34;</span>
      <span class="na">android:text=</span><span class="s">&#34;ログイン&#34;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></div><p>あとはボタンが押されたときにブラウザを呼ぶだけです．
認証したらPINコードを入力してもらいます．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">net.sorablue.shogo82148.yuire</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">twitter4j.AsyncTwitter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.AsyncTwitterFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.auth.AccessToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.auth.RequestToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.view.View.OnClickListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.EditText</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OAuthActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="kd">implements</span> <span class="n">OnClickListener</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EXTRA_CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&#34;consumer_key&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EXTRA_CONSUMER_SECRET</span> <span class="o">=</span> <span class="s">&#34;consumer_secret&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EXTRA_ACCESS_TOKEN</span> <span class="o">=</span> <span class="s">&#34;access_token&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">EXTRA_ACCESS_TOKEN_SECRET</span> <span class="o">=</span> <span class="s">&#34;access_token_secret&#34;</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">RequestToken</span> <span class="n">mRequestToken</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">AsyncTwitterFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AsyncTwitterFactory</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">AsyncTwitter</span> <span class="n">twitter</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
    
    <span class="c1">// 非同期版 Twitter4J のリスナ
</span><span class="c1"></span>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TwitterListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TwitterAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">gotOAuthRequestToken</span><span class="o">(</span><span class="n">RequestToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mRequestToken</span> <span class="o">=</span> <span class="n">token</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">gotOAuthAccessToken</span><span class="o">(</span><span class="n">AccessToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Access Token 取得成功
</span><span class="c1"></span>                <span class="c1">// 呼び出し元に Access Token を返す
</span><span class="c1"></span>                <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
                <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">EXTRA_ACCESS_TOKEN</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span>
                <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="n">EXTRA_ACCESS_TOKEN_SECRET</span><span class="o">,</span> <span class="n">token</span><span class="o">.</span><span class="na">getTokenSecret</span><span class="o">());</span>
                <span class="n">setResult</span><span class="o">(</span><span class="n">Activity</span><span class="o">.</span><span class="na">RESULT_OK</span><span class="o">,</span> <span class="n">intent</span><span class="o">);</span>
                <span class="n">finish</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_oauth</span><span class="o">);</span>

        <span class="c1">// Request Token をリクエスト
</span><span class="c1"></span>        <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">getIntent</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">consumer_key</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">EXTRA_CONSUMER_KEY</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">consumer_secret</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">EXTRA_CONSUMER_SECRET</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">setOAuthConsumer</span><span class="o">(</span><span class="n">consumer_key</span><span class="o">,</span> <span class="n">consumer_secret</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthRequestTokenAsync</span><span class="o">();</span>
        
        <span class="c1">// EventListener をセット
</span><span class="c1"></span>        <span class="kd">final</span> <span class="n">View</span> <span class="n">start_login</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_start_login</span><span class="o">);</span>
        <span class="n">start_login</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">View</span> <span class="n">login</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_login</span><span class="o">);</span>
        <span class="n">login</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">getId</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_start_login</span><span class="o">:</span>
            <span class="o">{</span>
                <span class="c1">// 認証画面をブラウザで開く
</span><span class="c1"></span>                <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span>
                                                 <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">mRequestToken</span><span class="o">.</span><span class="na">getAuthorizationURL</span><span class="o">()));</span>
                <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button_login</span><span class="o">:</span>
            <span class="o">{</span>
                <span class="c1">// PINコードを取得
</span><span class="c1"></span>                <span class="kd">final</span> <span class="n">String</span> <span class="n">pin</span> <span class="o">=</span> <span class="n">editPin</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
                
                <span class="c1">// Access Token をリクエスト
</span><span class="c1"></span>                <span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthAccessTokenAsync</span><span class="o">(</span><span class="n">mRequestToken</span><span class="o">,</span> <span class="n">pin</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>Token の取得にはインターネットアクセスが必要なので，
Twitter4J に含まれている非同期版のライブラリを使っています．</p>
<p>Consumer Key と Consumer Secret はアクティビティの呼び出し時にインテントに設定します．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kt">int</span> <span class="n">REQUEST_ACCESS_TOKEN</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">OAuthActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setExtraString</span><span class="o">(</span><span class="n">OAuthActivity</span><span class="o">.</span><span class="na">EXTRA_CONSUMER_KEY</span><span class="o">,</span> <span class="s">&#34;Your Cosumer Key&#34;</span><span class="o">);</span>
<span class="n">intent</span><span class="o">.</span><span class="na">setExtraString</span><span class="o">(</span><span class="n">OAuthActivity</span><span class="o">.</span><span class="na">EXTRA_CONSUMER_SECRET</span><span class="o">,</span> <span class="s">&#34;Your Consumer Secret&#34;</span><span class="o">);</span>
<span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">REQUEST_ACCESS_TOKEN</span><span class="o">);</span>
</code></pre></div><p>認証が完了すると <code>onAcivityResult</code> が呼び出されるので，
Access Token を保存するなり，つぶやくのに使うだけです．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="n">REQUEST_ACCESS_TOKEN</span> <span class="o">&amp;&amp;</span> <span class="n">resultCode</span> <span class="o">==</span> <span class="n">Activity</span><span class="o">.</span><span class="na">RESULT_OK</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">OAuthActivity</span><span class="o">.</span><span class="na">EXTRA_ACCESS_TOKEN</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">token_secret</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">getStringExtra</span><span class="o">(</span><span class="n">OAuthActivity</span><span class="o">.</span><span class="na">EXTRA_ACCESS_TOKEN_SECRET</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">setOAuthAccessToken</span><span class="o">(</span><span class="k">new</span> <span class="n">AccessToken</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="n">token_secret</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="intent-filterを利用">Intent Filterを利用</h3>
<p>二つ目の方法は Intent Fileter を使って
callback URL へアクセスしたときに，ブラウザにインテントを発行してもらう方法です．
ユーザがPINコードを覚える必要がないので楽ちんです．</p>
<p>** (2013-03-09追記) **
この記事を公開したらギルティ言われてしまいました．
(<a href="https://gist.github.com/mala/5062931">TwitterのOAuthの問題まとめ</a>・<a href="https://gist.github.com/mala/5107120">TwitterのOAuthの問題の補足とか</a>)
「Consumer Key が漏れる可能性を否定できないクライアントアプリでは，Callback URL をつかべきではない」とのご指摘です．
ごもっとなご意見です．
この方法は** 非推奨 **です．
PINコードを使った認証を使いましょう．</p>
<p>その分開発は面倒ですが．
ポイントは以下の点です．</p>
<ul>
<li>Twitter へのアプリケーション登録時に Callback URL にテキトーなURLを入れておく</li>
<li>独自スキーマを定義して，受け取れるようにしておく</li>
<li><code>getOAuthRequestToken</code> 呼び出し時に，Callback URL を明示的に渡す</li>
<li>アクティビティの多重起動を防止しておく</li>
</ul>
<p>Intent Filter に http:// で始まるURLでも設定してしまうと，
アプリケーションの選択画面が開いてしまったり，
ブラウザによってはリダイレクト時にインテントを飛ばしてくれなかったりします．
そのため， myapplication:// のような独自スキーマを使う必要があるのですが，
Twitterへアプリケーション登録時に設定する Callback URL は http:// で始まっていないと受け付けてくれません．
かと言って空にしておくとうまく動かないので callback URL にはテキトーな URL を入れておいて，
<code>getOAuthRequestToken</code> 呼び出し時に Callback URL を指定します(なぜかこっちは独自スキーマが使える)．</p>
<p>具体的なプログラムは以下のような感じ．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">net.sorablue.shogo82148.yuire</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">twitter4j.AsyncTwitter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.AsyncTwitterFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.TwitterMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.auth.AccessToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">twitter4j.auth.RequestToken</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.net.Uri</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CALLBACK</span> <span class="o">=</span> <span class="s">&#34;myappsheme://callback/&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&#34;Your consumer_key&#34;</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="s">&#34;Your consumer secret&#34;</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">RequestToken</span> <span class="n">mRequestToken</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">AsyncTwitterFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AsyncTwitterFactory</span><span class="o">();</span>
    <span class="kd">final</span> <span class="n">AsyncTwitter</span> <span class="n">twitter</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">TwitterListener</span> <span class="n">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TwitterAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">gotOAuthRequestToken</span><span class="o">(</span><span class="n">RequestToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// ブラウザを開く
</span><span class="c1"></span>                <span class="n">mRequestToken</span> <span class="o">=</span> <span class="n">token</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">,</span>
                                                 <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">mRequestToken</span><span class="o">.</span><span class="na">getAuthorizationURL</span><span class="o">()));</span>
                <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">gotOAuthAccessToken</span><span class="o">(</span><span class="n">AccessToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// 永続化とかする
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">};</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_oauth</span><span class="o">);</span>

        <span class="n">twitter</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">setOAuthConsumer</span><span class="o">(</span><span class="n">CONSUMER_KEY</span><span class="o">,</span> <span class="n">CONSUMER_SECRET</span><span class="o">);</span>

        <span class="c1">// 認証開始
</span><span class="c1"></span>        <span class="c1">// Request Token を取得する
</span><span class="c1"></span>        <span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthRequestTokenAsync</span><span class="o">(</span><span class="n">CALLBACK</span><span class="o">);</span> <span class="c1">// ここで CALLBACK URL を渡す！
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onNewIntent</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// callback してきた
</span><span class="c1"></span>        <span class="kd">final</span> <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">uri</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="o">;</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">verifier</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">getQueryParameter</span><span class="o">(</span><span class="s">&#34;oauth_verifier&#34;</span><span class="o">);</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthAccessTokenAsync</span><span class="o">(</span><span class="n">mRequestToken</span><span class="o">,</span> <span class="n">verifier</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>多重起動防止と独自スキーマの定義はマニフェストに記述します．</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;activity</span>
    <span class="na">android:name=</span><span class="s">&#34;.MainActivity&#34;</span>
    <span class="na">android:label=</span><span class="s">&#34;@string/title_activity_main&#34;</span>
    <span class="na">android:launchMode=</span><span class="s">&#34;singleTask&#34;</span> <span class="nt">&gt;</span> <span class="c">&lt;!-- 多重起動防止 --&gt;</span>

    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&#34;android.intent.action.MAIN&#34;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&#34;android.intent.category.LAUNCHER&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
    
    <span class="c">&lt;!-- 独自スキーマの定義 --&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&#34;android.intent.action.VIEW&#34;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&#34;android.intent.category.DEFAULT&#34;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&#34;android.intent.category.BROWSABLE&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&#34;myappsheme&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div><p><code>launchMode</code> に <code>singleTask</code> を指定すると，
多重起動のときに新しいアクティビティを起動する代わりに，すでに起動していたアクティビティの <code>onNewIntent</code> が実行されます．</p>
<p>PINコードを同じインターフェース(<code>startActivityForResult</code> で認証用アクティビティを呼び出すと，戻り値に Access Token が入っている)にしたかったけど，
認証用アクティビティが <code>singleTask</code> だと，ブラウザを開いた時に呼び出し元の<code>onActivityResult</code>が呼び出されてしまう．
誰かいい案ありません？</p>
<h2 id="まとめ">まとめ</h2>
<p>WebViewはアプリからブラウザの機能を扱うのに非常に便利ですが，
あくまでもアプリの管理下にあるもので，ブラウザとは少し性質が違うものということに注意．
<a href="http://ierae.co.jp/uploads/webview.pdf">WebViewの脆弱性</a>に関する資料を見つけてビクビクしています．
認証画面にかぎらず WebView を使うときはセキュリティに注意しましょう．</p>
<p>今回調べたことを使って，
じょりぼっとにお湯入れたとつぶやくだけのアプリ<a href="https://github.com/shogo82148/yuire">「お湯入れた」</a>を
作りました．
3分間計りたいときにどうぞ．</p>
<p><a href="https://twitter.com/JO_RI_bot" class="twitter-follow-button" data-show-count="false" data-lang="ja">@JO_RI_botさんをフォロー</a></p>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<h2 id="おへんじ">おへんじ</h2>
<p>たくさんシェアしてもらったのでお返事書いておきます．</p>
<blockquote class="twitter-tweet" lang="ja"><p>たしかにそうなんだけど、PIN形式は実装が手間だし、PINコピペするのも手間だし、IntentFilter形式は空のブラウザー窓が残るのがものすごく気になるんだよなぁ… / “OAuthの認証にWebViewを使うのはやめよう - S…” <a href="http://t.co/NS0kyGg2" title="http://htn.to/hZZLhx">htn.to/hZZLhx</a></p>&mdash; たくじさん (@takuji31) <a href="https://twitter.com/takuji31/status/272987171202424833" data-datetime="2012-11-26T08:56:28+00:00">11月 26, 2012</a></blockquote>
<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>WebViewでURLフックを入れるよりは，PINコードのほうがコードもわかりやすく簡単かと．
ただPINコードのコピペが面倒なのはそのとおりなので，Android アプリの場合採用は難しいかもしれません．</p>
<p>Intent Filterはマニフェストに手を入れる必要がある分面倒．ブラウザにタブが残るのも厄介です．
ここは利便性とセキュリティとのトレードオフと割り切るしか無いでしょう．
Web上での本人確認の方法がパスワードくらいしかない以上，パスワード流出の危険性はかなり重大な欠陥だと言えます．
手間なのは最初の一回だけですし，Intent Filter を使うのが賢い方法だと思います．</p>
<blockquote class="twitter-tweet" lang="ja"><p>追記。あと標準ブラウザも絶対ダメ。。→そもそもWebViewを使っちゃダメなのよ。。Android版のChromeだけ使いましょう。。 / “OAuthの認証にWebViewを使うのはやめよう - Shogo's Blog” <a href="http://t.co/jjo1o4Gb" title="http://htn.to/ybxt7Y">htn.to/ybxt7Y</a></p>&mdash; Kietaさん (@typex20) <a href="https://twitter.com/typex20/status/273001101798813696" data-datetime="2012-11-26T09:51:49+00:00">11月 26, 2012</a></blockquote>
<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>はい．おっしゃるとおりです．
わざわざ反論してまで WebView を使う理由が思い浮かびません．
代替手法を考えるべきだと思います．</p>
<blockquote class="twitter-tweet" lang="ja"><p>安全に実装できるんならこしたことはないけど、悪意のある実装を前提にするのならWebViewでも他のコンポーネントでもかわらないかな。どっちかというと外部サイトビューワーの役割を持つWebViewでフィッシング開くじょとの方がリスク高そう<a href="http://t.co/QB2HoJSc" title="http://shogo82148.github.com/blog/2012/11/24/no-more-webview/">shogo82148.github.com/blog/2012/11/2…</a></p>&mdash; laiso(レイソー)さん (@laiso) <a href="https://twitter.com/laiso/status/273027828126187520" data-datetime="2012-11-26T11:38:01+00:00">11月 26, 2012</a></blockquote>
<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<blockquote class="twitter-tweet" data-in-reply-to="273027828126187520" lang="ja"><p>@<a href="https://twitter.com/laiso">laiso</a> 普段使ってるブラウザでログイン済みの場合なら、少なくともパスワード取られないことが保証できるので、WebViewだろうとブラウザっぽいものだろうとパスワード聞かれたタイミングで警戒すべき、という方が分かりやすいんじゃないかと思う。</p>&mdash; malaさん (@bulkneets) <a href="https://twitter.com/bulkneets/status/273029308254154753" data-datetime="2012-11-26T11:43:54+00:00">11月 26, 2012</a></blockquote>
<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>このポストで取り上げているのは「認証画面を偽装してパスワードを盗む」ことが可能という，まさしくフィッシングの話題です．
開発者は，自前で「** ブラウザっぽいもの ** 」を実装するのではなく，「 ** 本物のブラウザ ** 」を使いましょう，という紹介でした．</p>
<p>問題なのは「パスワードを聞かれる or 聞かれない」ではなく，「どのアプリがパスワードを聞いているか」です．
ログインしていなければ当然Webブラウザでもパスワードは聞かれます．
認証を求めているアプリとは別の，** 信用のできるアプリ ** がパスワードを聞いてくるということが重要なのです．
Webブラウザを信用出来ないというのであれば，そもそもWebサービスを使うべきではありません．</p>
<blockquote class="twitter-tweet" lang="ja"><p>OAuthの認証にWebViewを使うのはやめよう - Shogo's Blog<a href="http://t.co/EQElowcq" title="http://bit.ly/S75tRa">bit.ly/S75tRa</a> WebView使って怪し気な事してたらどうせパケットキャプチャでばれない？ まぁ、PINの方が確実に安全だと思うのでそこは賛成だけど</p>&mdash; nakamura001さん (@nakamura001) <a href="https://twitter.com/nakamura001/status/273012182357266432" data-datetime="2012-11-26T10:35:51+00:00">11月 26, 2012</a></blockquote>
<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>パケットキャプチャだけでは見抜けないと思います．
認証画面のDOM要素を直接見れば，通信にまったく介入しなくてもパスワードなんて簡単に抜けます．
実際には WebView からDOM要素を見ることはできないようですが，
DOM 操作が可能な WebView を自前実装することだって技術的には可能です．
そのため，パスワードを盗みとっているかどうかを外からみた動作だけで判断することは非常に難しく，
内部構造を解析する必要があると思います．</p>
<p>パケットキャプチャやらリバースエンジニアリングを駆使すれば理論的はすべての不正は防げるとは思いますが，
それをすべてのアプリでやるのは非常に面倒ですし，一般ユーザが実践するのは困難です．
こういうことをやらなくてもある程度安全にサービスを使えるようにするのが OAuth の役割．
積極的に利用していくべきでしょう．</p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">ICHINOSE Shogo</span></span>
    
    <time>Nov 24, 2012</time>
    
    </span>
  </p>

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://shogo82148.github.io/blog/2012/11/23/tinysegmentermaker/" title="TinySegmenterの学習ツールを作ってみた">TinySegmenterの学習ツールを作ってみた</a>
    

    
      <a class="basic-alignment right" href="https://shogo82148.github.io/blog/2012/12/05/kikoemasuka/" title="聞こえますか…自動生成…してみた…よ…">聞こえますか…自動生成…してみた…よ…</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      
      
      
      if (window.location.hostname == "localhost")
          return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'shogosblog';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/shogo82148/" title="https://github.com/shogo82148/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/shogo82148/" title="https://twitter.com/shogo82148/"><i class="fa fa-twitter fa-3x"></i></a>
      
         
      
      
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
          
            
              <li class="post">
                <a href="/blog/2022/09/20/2022-09-20-aws-sdk-v2-and-googleapi-break-my-code/">AWS SDK v2 for Goが壊れた、Googleお前もか</a>
              </li>
            
          
            
          
            
              <li class="post">
                <a href="/blog/2022/08/11/2022-08-11-git-push-auto-setup-remote/">git push のときに自動的にリモートブランチを作成する設定</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/06/11/2022-06-11-wild-iphone-appeared/">落とし物の iPhone を交番に届けた話</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/05/27/2022-05-27-configure-rpath-via-ldflags/">動的ライブラリの検索パスに、実行バイナリからの相対パスを入れたい</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/05/16/2022-05-16-perl-extra-paired-delimiters/">Perl の extra_paired_delimiters を先取り！</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/05/06/2022-05-06-canonicalizing-my-name/">本名の英語表記を姓名の順に統一していくぞという話</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/04/25/2022-04-25-jq-program/">jq の引数を省略したときの挙動が違う件</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/04/19/2022-04-19-check-your-aws-lambda-runtimes/">EOL間近の AWS Lambda Runtimes を探すスクリプト</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2022/04/15/2022-04-15-implement-bioctal/">RFC9226 Bioctal: Hexadecimal 2.0 の Go 実装を書いてみた</a>
              </li>
            
          
        </ul>
      </section>
    
  
</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2022 ICHINOSE Shogo - <a
      href="https://shogo82148.github.io/license/">License</a> -
    <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank"
        href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
  </p>
</footer>










<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
})
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  let all = MathJax.Hub.getAllJax()
  for(let o of all) {
      o.SourceElement().parentNode.className += ' has-jax'
  }
})
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



<script>
  var _gaq = [['_setAccount', 'UA-4526627-4'], ['_trackPageview']];
  (function (d, t) {
    var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
    g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s)
  }(document, 'script'));
</script>

</body>

</html>

