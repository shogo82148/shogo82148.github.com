<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&family=Noto+Sans+Mono&display=swap" rel="stylesheet"> 

  
  <title>GitHub Actions を使って AWS SAM をデプロイしてみる</title>

  
  
  <link rel="stylesheet" href="/css/hugo-octopress.css">

  
  
    <link rel="stylesheet" href="https://shogo82148.github.io/css/syntax.css">
  

  
  <link href="https://shogo82148.github.io/favicon.png" rel="icon">

  
  

  <meta name="description" content="" />
  <meta name="keywords" content="">
  <meta name="author" content="ICHINOSE Shogo">

  
  <meta name="generator" content="Hugo 0.120.4">


<script async src="https://www.googletagmanager.com/gtag/js?id=G-40R0PCLKVF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-40R0PCLKVF');
</script>


<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

  
  
</head>
<body>


<header role="banner">
<hgroup>
  
  <h1><a href="https://shogo82148.github.io/">Shogo&#39;s Blog</a></h1>
  <h2></h2>
</hgroup>
</header>


<nav role="navigation">
<fieldset class="mobile-nav">
  
  <select onchange="location = this.value;">
    <option value="">Navigate…</option>
      
  </select>
</fieldset>


<ul class="main-navigation">
  
  
</ul>

<ul class="subscription">
  
</ul>


  <form action="https://www.google.com/search" method="get" target="_blank">
    <fieldset role="search">
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
      <input type="hidden" name="q" value="site:https://shogo82148.github.io/" />
    </fieldset>
  </form>

</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
  <p class="meta">Jan 2, 2022
     - 5 minute read 
     - <a href="https://shogo82148.github.io/blog/2022/01/02/deploy-aws-sam-with-github-actions/#disqus_thread">Comments</a>

    
    
      - <a class="label" href="https://shogo82148.github.io/categories/aws/">aws </a>
    
  </p>
  <h1 class="entry-title">
     GitHub Actions を使って AWS SAM をデプロイしてみる 
  </h1>
</header>


        <div class="entry-content">
          
          
          
          
          <p><a href="https://docs.github.com/en/code-security/supply-chain-security/keeping-your-dependencies-updated-automatically">dependabot</a> を使って
依存ライブラリの更新に追従しているのですが、
API のようなデプロイが必要なものは当然ながらデプロイしないと意味がありません。
今までは手元でデプロイしてきましたが、いい加減面倒になったので GitHub Actions を使った自動化をしてみました。</p>
<p>とりあえずお試しで <a href="https://github.com/shogo82148/holidays-jp">shogo82148/holidays-jp</a> にワークフローを設定してみました。
<a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">AWS SAM</a> を使った API で、
データーベースや外部サービスとの連携のないシンプルなものです。
API 自体の使い方はこちらをどうぞ。</p>
<ul>
<li><a href="https://shogo82148.github.io/blog/2021/09/04/holidays-api-is-released/">祝日 API を公開しました</a></li>
</ul>
<h2 id="単純にデプロイした場合の問題点">単純にデプロイした場合の問題点</h2>
<p>GitHub Actions の環境にはすでに AWS CLI, AWS SAM CLI, Go 等々ビルドに必要なものはすでにインストールされています。
あとは <strong>「適切な権限を設定」</strong> すればデプロイ自体は直ぐにできます。
ただまあ、この「適切な権限を設定」が一番の難所なので今まで二の足を踏んでいたわけです。</p>
<p>AWS SAM で作成した API は <a href="https://aws.amazon.com/jp/lambda/">AWS Lambda</a> によって実行されるのですが、
Lambda 関数に適切な権限を渡すために <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">IAM Role</a> を作成する必要があります。
つまり SAM アプリケーションのデプロイには「IAM を操作する権限」というかなり強力な権限を GitHub Actions に渡さなければなりません。</p>
<p>例えば GitHub Actions からデプロイ用 IAM ユーザーのアクセスキーが漏れたとしましょう。
IAM ユーザー自体の権限を最小限に絞っていたとしても、アクセスキーを入手した人は「IAM を操作する権限」を使って「AWS アカウントのすべての操作が可能な管理者ユーザー」を作ることができてしまいます。
いわゆる <strong>権限昇格の脆弱性</strong> です。
「管理者ユーザー」さえ作ってしまえば、EC2 のインスタンスを大量にたてて仮想通貨のマイニングをしたり、S3 から情報を抜き取ったりと、デプロイとは無関係のことも何でもできてしまいます。</p>
<p>ようするに「IAM を操作する権限」を付与するということは「AWS アカウントの管理者権限」を付与するのとほぼ同義です。
GitHub Actions 自体のセキュリティが万全であったとしても、万が一を考えると気軽に渡せるものではないですよね。</p>
<h2 id="対策">対策</h2>
<p>「万が一」のことばかり考えて自動化から逃げていると手作業が増えて大変になっていくばかりなので、
許容可能な範囲にリスクを低減することを考えましょう。
以下の 3 つの対策を行いました。</p>
<ul>
<li>Permissions boundaries の設定</li>
<li>AWS CloudFormation service role の利用</li>
<li>OpenID Connect を用いた一時的なアクセストークン発行</li>
</ul>
<h3 id="permissions-boundaries-の設定">Permissions boundaries の設定</h3>
<p>まずは一番の問題である権限昇格への対応です。
Permissions boundaries (アクセス許可の境界) の設定です。</p>
<ul>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">Permissions boundaries for IAM entities</a></li>
</ul>
<p>なんか難しそうですね・・・ええ、実際 <strong>かなり</strong> 難しいです。
アレコレ説明するよりも具体的な設定を見ながらのほうがわかりやすいと思うので、早速設定を見ていきましょう。</p>
<p>Permissions boundaries と難しそうな名前がついていますが、実体はただの IAM ポリシーです。
以下は AWS Lambda の実行ロールに付与した Permissions boundaries の CloudFormation テンプレートです。
API の動作に必要な CloudWatch Logs と System Manager だけを許可して、 <code>holidays-jp-permission-boundary-ap-northeast-1</code> という名前をつけました。
通常の IAM ポリシーと何も変わらないですね。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/b36054872de0ba3a44a78a2e80d5ed21b54fcbca/cicd.yaml#L6-L20">cicd.yaml#L6-L20</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Permission Boundary for Roles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">PermissionsBoundary</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">AWS::IAM::ManagedPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Properties</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l">Permission Boundary for holidays-jp Roles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ManagedPolicyName</span><span class="p">:</span><span class="w"> </span>!<span class="l">Sub &#34;holidays-jp-permissions-boundary-${AWS::Region}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PolicyDocument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2012-10-17&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Statement</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">ServiceBoundaries</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;logs:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;ssm:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span></code></pre></div><p>実際に利用しているのが SAM テンプレートの以下の部分です。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/b36054872de0ba3a44a78a2e80d5ed21b54fcbca/template.yaml#L6-L9">template.yaml#L6-L9</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Globals</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Function</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Timeout</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PermissionsBoundary</span><span class="p">:</span><span class="w"> </span>!<span class="l">Sub &#34;arn:aws:iam::${AWS::AccountId}:policy/holidays-jp-permissions-boundary-ap-northeast-1&#34;</span><span class="w">
</span></span></span></code></pre></div><p><code>Globals</code> セクションの <code>Function.PermissionsBoundary</code> に設定することで、このテンプレート内で管理しているすべての IAM ロールに
<code>PermissionsBoundary</code> の設定が適用されます。
これによって AWS Lambda の権限を <code>holidays-jp-permissions-boundary-ap-northeast-1</code> に書いた設定で制限することができます。
今回の例では CloudWatch Logs と System Manager へのアクセスだけが許可され、他のサービスへのアクセスは (暗黙的に) 拒否されます。</p>
<p>ここまでなら「普通に IAM ロールのインラインポリシーやマネージドポリシーに設定追加するのと一緒だよね？」という話になりますよね。</p>
<p>そのとおり、Permissions boundaries が設定された IAM ロールをただ利用するだけであればメリットはありません。
Permissions boundaries が活きてくるのは「IAM ロールを作成するとき」です。
AWS Lambda の作成を行う「CloudFormation でデプロイを行うためのロール」を見てみましょう。注目すべきなのはこの部分です。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/b36054872de0ba3a44a78a2e80d5ed21b54fcbca/cicd.yaml#L36-L53">cicd.yaml#L36-L53</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Policies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">PolicyName</span><span class="p">:</span><span class="w"> </span><span class="l">deploy-sam-templates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PolicyDocument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2012-10-17&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Statement</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">CreateOrChangeOnlyWithBoundary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:CreateRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PutRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:AttachRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DetachRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeleteRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PutRolePermissionsBoundary&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Condition</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">StringEquals</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">&#34;iam:PermissionsBoundary&#34;: </span>!<span class="l">Ref PermissionsBoundary</span><span class="w">
</span></span></span></code></pre></div><p>IAM ポリシーの <code>Condition</code> (条件) 要素に <code>iam:PermissionsBoundary</code> を指定しています。
こうすることで IAM ロール作成時(<code>iam:CreateRole</code>)に <code>PermissionsBoundary</code> の設定を強制することができます。
<code>PermissionsBoundary</code> の設定をせずに IAM ロールを作成すると、以下のようにエラーを吐いて失敗します。</p>
<blockquote>
<p>iam:CreateRole User: arn:aws:sts::445285296882:assumed-role/holidays-jp-cfn-service-role-ap-northeast-1/AWSCloudFormation is not authorized to perform: iam:CreateRole on resource: arn:aws:iam::445285296882:role/holidays-jp-AdminRole-LUUBFXRI6WMS</p>
</blockquote>
<p>これにより Permissions boundaries より広い範囲の権限を持つ IAM ロールは作成できなくなります。
今回であれば CloudWatch Logs と System Manager 以外のサービスにアクセスする IAM ロールは作成できず、
権限の昇格を防ぐことができます。</p>
<p>・・・と思いたいんですが、実は 「IAM ロール新規作成」だけ塞いだのでは不十分です。
いろんな穴を塞ぎつつ、必要な IAM ロールを作るために最終的には以下のようなルールを書きました。</p>
<ul>
<li>IAM ロール新規作成時に <code>PermissionsBoundary</code> の設定を強制する
<ul>
<li><code>iam:CreateRole</code> アクションの <code>Condition</code> 要素</li>
</ul>
</li>
<li>既存の IAM ロール(主に自分自身)の権限を書き換えて昇格するのを防ぐ
<ul>
<li><code>iam:PutRolePolicy</code>, <code>iam:AttachRolePolicy</code>, <code>iam:DetachRolePolicy</code>, <code>iam:DeleteRolePolicy</code> アクションの <code>Condition</code> 要素</li>
</ul>
</li>
<li>既存の IAM ロールに <code>PermissionsBoundary</code> を新たに設定するのは許可する
<ul>
<li><code>iam:PutRolePermissionsBoundary</code> アクションの許可</li>
</ul>
</li>
<li>Permissions boundaries を更新して昇格するのを防ぐ</li>
<li>一回 <code>PermissionsBoundary</code> を設定したあとに削除して設定を無効化するのを防ぐ</li>
<li>その他の IAM ロールに関連する操作は許可</li>
<li>一般的な SAM テンプレートの範囲なら IAM ユーザ や IAM グループを利用することはないので、それらの操作は禁止</li>
<li>加えて SAM のリソース作成に必要な IAM 以外の権限
<ul>
<li>AWS Lambda, API Gateway など</li>
</ul>
</li>
</ul>
<p>対応する CloudFormation のテンプレートは以下の部分です。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/c7b5e8e9d1bafafe3e4d9178680851502299b6ed/cicd.yaml#L36-L104">cicd.yaml#L36-L104</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Policies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">PolicyName</span><span class="p">:</span><span class="w"> </span><span class="l">deploy-sam-templates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PolicyDocument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2012-10-17&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Statement</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">CreateOrChangeOnlyWithBoundary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:CreateRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PutRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:AttachRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DetachRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeleteRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PutRolePermissionsBoundary&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Condition</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">StringEquals</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">&#34;iam:PermissionsBoundary&#34;: </span>!<span class="l">Ref DeploymentPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">NoBoundaryPolicyEdit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Deny</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:CreatePolicyVersion&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeletePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeletePolicyVersion&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:SetDefaultPolicyVersion&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- !<span class="l">Ref DeploymentPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">NoBoundaryRoleDelete</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Deny</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeleteRolePermissionsBoundary&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">OtherIAMTasks</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># handle IAM Roles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:ListRolePolicies&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:ListRoleTags&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:ListRoles&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:GetRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:GetRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:ListAttachedRolePolicies&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:UpdateRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:UpdateRoleDescription&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:UpdateAssumeRolePolicy&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:TagRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:UntagRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeleteRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PassRole&#34;</span><span class="w"> </span><span class="c"># 2023-08-04 追記: Lambda関数のランタイムを変更するために必要</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># handle Service Linked Roles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:ListPoliciesGrantingServiceAccess&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:CreateServiceLinkedRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:DeleteServiceLinkedRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:GetServiceLinkedRoleDeletionStatus&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">CloudFormationStackOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;cloudformation:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;lambda:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;route53:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;acm:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;apigateway:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;s3:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;events:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span></code></pre></div><p>・・・これで全部塞いだつもりなんですが自信がないので、間違いに気がついた人はこっそり教えて下さい。</p>
<p>Permissions boundaries やデプロイ用 IAM ロールを GitHub Actions から書き換えできてしまったら自由に権限昇格できてしまって意味がないので、
これらは別スタックで僕自身の権限を使って作成、 GitHub Actions からは変更禁止にします。</p>
<p>これは Permissions boundaries の更新を自動化できなくなると言うことですが、
更新が必要な場合はどうせ手作業で動作確認をするので問題にはならないでしょう。</p>
<h3 id="aws-cloudformation-service-role-の利用">AWS CloudFormation service role の利用</h3>
<p>CloudFormation が AWS リソースの操作を行う際は、特に何も指定しなければ CloudFormation の操作を行ったユーザの権限が使用されます。
ここで<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-iam-servicerole.html">AWS CloudFormation service role</a> という機能を使うと、
リソースの操作に指定した IAM ロールの権限を使ってくれます。</p>
<p>SAM CLI では設定ファイル <code>samconfig.toml</code> に <code>role_arn</code> という項目があるので、ここにリソース操作用のロールを指定します。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/b36054872de0ba3a44a78a2e80d5ed21b54fcbca/samconfig.toml#L6">samconfig.toml#L6</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="nx">role_arn</span> <span class="p">=</span> <span class="s2">&#34;arn:aws:iam::445285296882:role/holidays-jp-cfn-service-role-ap-northeast-1&#34;</span>
</span></span></code></pre></div><p>これの何が嬉しいかというと、 「GitHub Actions に IAM ロールを直接操作する権限を渡さなくて良い」という点です。
例えば先程の「CloudFormation でデプロイを行うためのロール」のポリシーには、SAM アプリケーションをデプロイするために AWS Lambda や API Gateway へのアクセス許可があります。
しかし 操作の対象となる AWS リソースの Arn は事前に分からないので、 <code>Resource</code> 要素を適切に設定することができません。
このままでは既存の Lambda 関数や API を変更・削除することができてしまいます。
それはちょっと怖い。</p>
<p>そこで AWS CloudFormation service role を使って「CloudFormation のスタック操作を行うロール」と「実際に AWS リソースの操作を行うロール」を分けます。
「CloudFormation のスタック操作を行うロール」は IAM ロールへ直接アクセスすることはできず、CloudFormation スタックの操作を介して操作をすることになります。
CloudFormation では基本的にスタックの外にあるリソースは操作できないので、こうすることによって「既存の Lambda 関数を変更する」といった操作はできなくなります。
CloudFormation スタックの操作を介することによって、既存のリソースを保護し、SAM CLI によって作成されたリソースのアクセスのみに限定することができるわけです。</p>
<p>「CloudFormation のスタック操作を行うロール」 には以下の権限が必要です。</p>
<ul>
<li>「実際に AWS リソースの操作を行うロール」 に操作を移譲するための権限</li>
<li>CloudFormation のスタックを操作する権限</li>
<li>CloudFormation テンプレートや Lambda 関数のコードを S3 にアップロードするための権限</li>
</ul>
<p>CloudFormation テンプレートの対応する箇所は以下のとおりです。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/6638af346b1e7c28c1cb92fdedd36f047ddbefb1/cicd.yaml#L127-L155">cicd.yaml#L127-L155</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Policies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">PolicyName</span><span class="p">:</span><span class="w"> </span><span class="l">SAMDeployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">PolicyDocument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2012-10-17&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Statement</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">CloudFormationOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;iam:PassRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w"> </span>!<span class="l">GetAtt DeploymentRole.Arn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">CloudFormationStackOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;cloudformation:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- !<span class="l">Sub &#34;arn:aws:cloudformation:ap-northeast-1:${AWS::AccountId}:stack/holidays-jp/*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- !<span class="l">Sub &#34;arn:aws:cloudformation:us-east-1:${AWS::AccountId}:stack/holidays-jp-update-trigger/*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">S3Operation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;s3:*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;arn:aws:s3:::aws-sam-cli-managed-default-samclisourcebucket-*/*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">Sid</span><span class="p">:</span><span class="w"> </span><span class="l">S3GetOperation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Action</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;s3:ListBucket&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">Resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;arn:aws:s3:::aws-sam-cli-managed-default-samclisourcebucket-*&#34;</span><span class="w">
</span></span></span></code></pre></div><h3 id="openid-connect-を用いた一時的なアクセストークン発行">OpenID Connect を用いた一時的なアクセストークン発行</h3>
<p>GitHub Actions の OpenID Connect 対応が GA になったので、これを使っています。</p>
<ul>
<li><a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">About security hardening with OpenID Connect</a></li>
</ul>
<p>有効期限の短いトークンが発行されるので、万が一流出したとしても被害を最小限に抑えることができます。</p>
<p>OpenID Connect と AWS の連携部分ですが、公式の Action ではなく自作のものを使っています。
理由は以下の記事にも書いたのですがセッションタグを使いたかったからです。</p>
<ul>
<li><a href="https://shogo82148.github.io/blog/2021/09/24/github-actions-oidc/">GitHub Actions + OIDC Token の情報を AWS のセッションタグに設定してみた</a></li>
<li><a href="https://github.com/fuller-inc/actions-aws-assume-role">fuller-inc/actions-aws-assume-role</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_session-tags.html#id_session-tags_permissions-required">Permissions required to add session tags</a></li>
</ul>
<p>セッションタグは信頼ポリシーの <code>Condition</code> 要素に条件として追加できるので、 「production 環境の場合のみアクセスを許可する」といったことが簡単にできます。
実際の例はこんな感じです。</p>
<ul>
<li><a href="https://github.com/shogo82148/holidays-jp/blob/b36054872de0ba3a44a78a2e80d5ed21b54fcbca/cicd.yaml#L110-L126">cicd.yaml#L110-L126</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2012-10-17&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Statement</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Principal</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">AWS</span><span class="p">:</span><span class="w"> </span><span class="l">arn:aws:iam::053160724612:root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Action</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;sts:AssumeRole&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Condition</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">StringEquals</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">&#34;sts:ExternalId&#34;: </span><span class="s2">&#34;R_kgDOF1U3OQ&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">StringLike</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">&#34;aws:RequestTag/Audience&#34;: </span><span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">&#34;aws:RequestTag/Environment&#34;: </span><span class="s2">&#34;production&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l">Allow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Principal</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">AWS</span><span class="p">:</span><span class="w"> </span><span class="l">arn:aws:iam::053160724612:root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Action</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;sts:TagSession&#34;</span><span class="w">
</span></span></span></code></pre></div><p>GitHub の Environment を見るだけであれば OIDC トークンの <code>sub</code> を見ても同じことはできるのですが、
セッションタグを使えば「 @shogo82148 以外のコミットは拒否する」といったより高度な設定も可能です。</p>
<p>これも以前書いたことなんですが、AWS か GitHub 側で正式に対応してくれませんかね。</p>
<h2 id="まとめ">まとめ</h2>
<p>AWS SAM の自動デプロイを行うさいには <strong>権限昇格の脆弱性</strong>を作り込まないよう注意が必要です。
今回は GitHub Actions からデプロイするために以下の 3 つの対策を行いました。</p>
<ul>
<li>Permissions boundaries の設定</li>
<li>AWS CloudFormation service role の利用</li>
<li>OpenID Connect を用いた一時的なアクセストークン発行</li>
</ul>
<p>Permissions boundaries によってこれでも簡単になったほうなんでしょうが、しっかりやると難しい・・・。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_boundaries.html">Permissions boundaries for IAM entities</a></li>
<li><a href="https://docs.aws.amazon.com/service-authorization/latest/reference/list_identityandaccessmanagement.html">Actions, resources, and condition keys for Identity And Access Management</a></li>
<li><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-iam-servicerole.html">AWS CloudFormation service role</a></li>
<li><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-iam-template.html#using-iam-template-conditions">AWS CloudFormation conditions</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-template-anatomy-globals.html">Globals section of the AWS SAM template</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html">AWS SAM CLI configuration file</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_session-tags.html#id_session-tags_permissions-required">Permissions required to add session tags</a></li>
<li><a href="https://github.com/shogo82148/holidays-jp">shogo82148/holidays-jp</a></li>
<li><a href="https://github.com/fuller-inc/actions-aws-assume-role">fuller-inc/actions-aws-assume-role</a></li>
<li><a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect">About security hardening with OpenID Connect</a></li>
<li><a href="https://shogo82148.github.io/blog/2021/09/04/holidays-api-is-released/">祝日 API を公開しました</a></li>
<li><a href="https://shogo82148.github.io/blog/2021/09/24/github-actions-oidc/">GitHub Actions + OIDC Token の情報を AWS のセッションタグに設定してみた</a></li>
</ul>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">ICHINOSE Shogo</span></span>
    
    <time>Jan 2, 2022</time>
    
    </span>
  </p>

  

  <p class="meta">
    
        <a class="basic-alignment left" href="https://shogo82148.github.io/blog/2022/01/02/perlfunc-fc/" title="Perl の fc で遊んでみる">Perl の fc で遊んでみる</a>
    

    
      <a class="basic-alignment right" href="https://shogo82148.github.io/blog/2022/01/29/hello-apple-silicon-m1/" title="M1 Apple Silicon 移行記">M1 Apple Silicon 移行記</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      
      
      
      if (window.location.hostname == "localhost")
          return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'shogosblog';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    

    <p>
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/shogo82148/" title="https://github.com/shogo82148/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/shogo82148/" title="https://twitter.com/shogo82148/"><i class="fa fa-twitter fa-3x"></i></a>
      
         
      
      
      
      
      
      
      
      

    
    
    </li>
  </ul>

  

  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
          
            
              <li class="post">
                <a href="/blog/2024/03/12/2024-03-12-use-mysql-new-connector-and-sql-open-db/">GoのMySQLドライバーを使うときはmysql.NewConnectorとsql.OpenDBを使おう</a>
              </li>
            
          
            
          
            
              <li class="post">
                <a href="/blog/2024/03/11/2024-03-11-before-connect-of-mysql-driver/">GoのMySQLドライバーにBeforeConnectが追加されました</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2024/02/06/2024-02-06-introduce-ridgenative-and-lambtrip/">AWS Lambda Function URLsのイベントをnet/httpで扱えるridgenativeとlambtripを書いた</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2024/02/04/2024-02-04-actions-setup-mysql-and-actions-setup-redis-now-work-on-macos14/">actions-setup-mysqlとactions-setup-redisがApple M1上で動くようになりました</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2024/02/01/2024-02-01-actions-setup-perl-now-works-on-macos14/">actions-setup-perlがApple M1上で動くようになりました</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2024/01/11/2024-01-11-go-forwarded-header/">GoでForwarded Headerのパーサーを作った</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2024/01/11/2024-01-11-not-found-resolve-endpoint-v2/">AWS SDK for Go v2にnot found ResolveEndpointV2と起こられたときの解決策</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2023/12/29/2023-12-29-go-retry-meets-generics/">go-retry v1.2.0 リリースのお知らせ、ジェネリクスがやってきた</a>
              </li>
            
          
            
              <li class="post">
                <a href="/blog/2023/12/29/2023-12-29-p5-aws-lambda-is-available-on-ca-east-1/">AWS::LambdaがCanada West (Calgary) Regionで利用可能になりました</a>
              </li>
            
          
        </ul>
      </section>
    
  
</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2024 ICHINOSE Shogo - <a
      href="https://shogo82148.github.io/license/">License</a> -
    <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank"
        href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
  </p>
</footer>









</body>

</html>

