<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: togetter | Shogo's Blog]]></title>
  <link href="http://shogo82148.github.io/blog/categories/togetter/atom.xml" rel="self"/>
  <link href="http://shogo82148.github.io/"/>
  <updated>2016-02-11T21:38:32+09:00</updated>
  <id>http://shogo82148.github.io/</id>
  <author>
    <name><![CDATA[Shogo Ichinose]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Togetterの編集作業便利にしたい]]></title>
    <link href="http://shogo82148.github.io/blog/2012/10/28/togetter-helper/"/>
    <updated>2012-10-28T01:11:00+09:00</updated>
    <id>http://shogo82148.github.io/blog/2012/10/28/togetter-helper</id>
    <content type="html"><![CDATA[<p><a href="http://togetter.com/">Togetter</a>はTwitterの投稿をまとめられる非常に便利なサイトですが，
編集画面が異様に使いにくいです．
そんなわけで<a href="/blog/2012/10/13/semiauto-togetter/">前回</a>は
自動的に検索ボタンを押してくれるブックマークレットを書いてみました．</p>

<p>それをユーザスクリプトにして，
ついでに編集画面の不便なところを修正してみました．</p>

<!-- More -->


<h2>編集を便利にするユーザスクリプト</h2>

<p>スクリプトはGistにあげておきました．</p>

<ul>
<li><a href="https://gist.github.com/3953476">https://gist.github.com/3953476</a></li>
<li><a href="https://gist.github.com/raw/3953476/TogetterHelper.user.js">インストールはこちら</a></li>
</ul>


<p>Chrome拡張<a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo">Tampermonkey</a>
で動作を確認しました．
この拡張，ユーザスクリプトの管理ができてオススメです．</p>

<h2>変更内容</h2>

<p>ユーザスクリプトは編集画面に対して次のような変更をします．</p>

<ul>
<li>画面レイアウトの変更</li>
<li>自動検索機能</li>
<li>重複削除・ソートの高速化</li>
<li>選択動作の変更</li>
<li>元に戻す機能</li>
<li>ショートカットキーの追加</li>
</ul>


<h3>画面レイアウトの変更</h3>

<p><a href="http://togetter.com/">Togetter</a>の編集画面のレイアウト，非常に使いにくいです．
ツイート一覧をスクロールしようとしたら画面全体がスクロールしてしまって，
編集用のボタンが隠れてしまう，ということが編集中に何度もあってイライラします．</p>

<p><strong> 余計なものでごちゃごちゃし過ぎなんだ！ </strong></p>

<p><strong> 僕は編集に集中したいんだ！ </strong></p>

<p>編集と関係の無いヘッダやナビゲーションは要らないので消えてもらうことにしました．
ツイートの一覧が画面いっぱいに表示され，
編集用のボタンは常常に画面上に表示されます．</p>

<h3>自動検索機能</h3>

<p>前回ブックマークレットで実現した機能です．
検索キーワードと一回あたりの読み込み回数を設定し，
「自動検索開始」ボタンを押しましょう．
すると，繰り返し間隔を聞いてくるので秒単位で時間を指定しましょう．
カウントダウンが始まり，周期的に検索・ソート・重複削除が行われます．</p>

<h3>重複削除．ソートの高速化</h3>

<p><a href="http://togetter.com/">Togetter</a>のソートのスピードはびっくりするほど遅いです．
例えば，「<a href="http://togetter.com/li/374199">劇的ビフォーアフター佐世保高専ラグビー部部室をリフォーム</a>」には
1190個のツイートが含まれています．
これを時間順にソートしてみたところ，
三回の平均で9.978秒(それぞれの結果は10.118秒, 9.925秒, 9.892秒)かかりました．
1000ツイート程度のソートに<strong>約10秒</strong>です．遅い！</p>

<p>ソート自体は数ミリ秒で終わるのになんでこんなに遅いというと，結果を画面に反映するのにjQueryのセレクタを大量に呼び出しているから．
ソートのときに一回読み込んだものをキャッシュしておけばもっと速くなるはず．</p>

<p>ってことで自前で実装してボタンを置き換えました．
結果0.171秒(0.174, 0.177, 0.161)まで短縮することができました．
<strong>約58倍</strong>の高速化！</p>

<p>高速化とは直接関係ないけど，
「選択したところだけソート」にしました．
ツイートを内容ごとに分類してるときとかに，
一部分だけソートできます(例:<a href="http://togetter.com/li/395528">ロボコン死亡かるた</a>)．
何も選択されてないときは何もしません．
全体をソートしたい時は明示的に全選択する必要があります．</p>

<p>重複削除とかも実装しなおしました．
約200ミリ秒かかってたのが約20ミリ秒に高速化！</p>

<h3>選択動作の変更</h3>

<p>もともとの編集画面では，ツイートをクリックするとクリックしたツイートの選択状態が切り替わります．
他に選択しているツイートがある場合，そのツイートは選択されたままです．
Excelとかではセルをクリックすると他のセルは非選択状態になるので，
それに慣れているとなんだか違和感があるんですよね．
そういうわけで，ツイートをクリックしたときは<strong>クリックしたツイートのみ</strong>選択されるようにしました．
複数選択ができないのも困るので，
Ctrlキーと同時クリックでクリックしたツイートを全部選択，
Shiftキーと同時クリックで範囲内のツイートを全部選択にしました．
Excelとかと一緒ですね．</p>

<h3>元に戻す機能</h3>

<p>ツイートの削除とか，時間順ソートとか，確認もなしにいきなりされるんですよ．
ツイートの削除はまた検索しなおせばいいかもしれないけど，
時間順ソートは凶悪です．
「<a href="http://togetter.com/li/395528">ロボコン死亡かるた</a>」とかせっかくあいうえお順に並べたのに
全部時間順にソートされてしまうんです．酷い！</p>

<p>そういうわけで，元に戻す機能をつけておきました．
間違ってツイートを削除してしまっても，間違えてソートしてしまっても，ボタンひとつで元通りです．</p>

<h3>ショートカットキーの追加</h3>

<p>マウスだけでの操作とか面倒なので，ショートカットキーを設定しました．</p>

<ul>
<li>Ctrl+S: 下書き保存</li>
<li>Ctrl+A: ツイートの全選択</li>
<li>Ctrl+Z: 元に戻す</li>
<li>Ctrl+Y: やり直す(元に戻すを取り消す)</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[半自動トゥギャりスクリプトを書いてみた]]></title>
    <link href="http://shogo82148.github.io/blog/2012/10/13/semiauto-togetter/"/>
    <updated>2012-10-13T17:35:00+09:00</updated>
    <id>http://shogo82148.github.io/blog/2012/10/13/semiauto-togetter</id>
    <content type="html"><![CDATA[<h2>togetterでたくさんツイートをまとめたい</h2>

<p><a href="https://twitter.com/">Twitter</a>は手軽に情報収集ができ他人とのコミニュケーションができる楽しいSNSですが、
古いツイートはしばらく経つとタイムラインや検索結果からはたどれなくなってしまいます。
過去のイベントに関するつぶやきを後から見たい、といった場合に不便です。</p>

<p>そこで登場するのが<a href="http://togetter.com/">togetter</a>というサービス。
<a href="https://twitter.com/">Twitter</a>のツイートを引用して、「まとめ」を作ることができます。
<a href="https://twitter.com/">Twitter</a>上での議論やイベントに対するみんなの反応がわかりやすく見れるので便利です。
僕も<a href="http://togetter.com/li/331948">JO_RI_botのツイート</a>をまとめたりといろいろとお世話になってます。</p>

<p>簡単なまとめを作るのには非常に便利な<a href="http://togetter.com/">togetter</a>。
しかし、ツイート数が多くなると少し大変です。
例えば何かのイベントのハッシュタグのついたツイートをまとめたい場合、
検索に現れるツイートの数には上限があるので、
漏れ無くツイートを集めるにはイベントの最中にまとめを作る必要があります。
<a href="http://togetter.com/">togetter</a>には自動更新機能がないので、数分毎に「検索」ボタンを押さなければなりません。
これは面倒だ・・・</p>

<h2>ブックマークレットを書いてみたよ</h2>

<p>面倒なので、自動的に検索ボタンを押すブックマークレットを書いてみた。</p>

<p><strong> <a href="/blog/2012/10/28/togetter-helper/">ユーザスクリプトで書き直してみたよ！</a> </strong></p>

<!-- more -->




<script>
// 直接書くとなぜかうまくいかない・・・
document.write("<a href=\"javascript:(function(){function%20g(){$(&quot;#num_select_search&quot;).val(100);$(&quot;#results&quot;).html(&quot;&quot;);a.click();setTimeout(function%20b(){var%20a=[];$(&quot;#results%20.action_item&quot;).map(function(){a.push($(this))});if(a.length==0){setTimeout(b,1e3);return}var%20c=$(&quot;#choices&quot;);a.reverse();$.each(a,function(){var%20a=this.attr(&quot;id&quot;);if(f[a])return;c.append(this);f[a]=1});cre.update()},1e3)}var%20a=$(&quot;.search_button&quot;);var%20b=$(&quot;<div></div>&quot;).insertAfter(a);var%20c=$('<input%20type=&quot;text&quot;%20value=&quot;60&quot;>').appendTo(b);var%20d=$('<input%20type=&quot;button&quot;%20value=&quot;開始&quot;>').appendTo(b);var%20e;d.click(function(){if(e){clearInterval(e);d.attr(&quot;value&quot;,&quot;開始&quot;)}else{e=setInterval(g,c.val()*1e3);d.attr(&quot;value&quot;,&quot;停止&quot;);g()}});var%20f={}})()\">半自動トゥギャりスクリプト(このリンクをブックマーク！)</a>");
</script>


<p>上のリンクをブックマークに登録しておき、<a href="http://togetter.com/">togetter</a>のまとめ作成ページを開くと、
検索ボックスのしたにテキストボックスとボタンが追加されます。
テキストボックスに検索ボタンを押す間隔(秒単位)を入れ、開始ボタンを押すと、
自動的に検索・移動・重複ツイートの削除・ソートをしてくれます。</p>

<h2>スクリプト</h2>

<p>元のスクリプトをgistにあげておきます。</p>

<p><div><script src='https://gist.github.com/3883841.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>

<p>ブラウザ拡張のほうが便利だろうけどブックマークレットとして実装しているのは、<a href="http://togetter.com/">togetter</a>のスクリプトやjQueryを自前のスクリプトから呼びたかったから。
ブラウザ拡張でも実現する方法はあるんだろうけど、調べるの面倒だからやってない。
DOMの操作だけでもなんとかなりそうだから、余力があれば書きなおすかも。</p>

<p>これ作るにあたって、<a href="http://togetter.com/">togetter</a>のソース見てたけど、重複削除やソートアルゴリズムがなんだか残念な感じ。
ツイート数に比例した回数だけjQueryのセレクタを呼び出している。
jQueryのセレクタって結構重い処理だし、オーダーが O( n<sup>2</sup> ) になるわけで・・・。
単なるソートにしては重すぎだろ、とは思ってはいたんだ。まさかこんな中身だとは。</p>
]]></content>
  </entry>
  
</feed>
